# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Базовые классы

### Класс Api
Класс `Api` - базовый класс для работы с API. Он позволяет отправлять GET и POST запросы к API проекта.

**Поля**
- `baseUrl: string` - базовый URL для запросов к серверу
- `options: RequestInit` - объект с дополнительными опциями для запросов

**Конструктор**
Конструктор класса принимает в качестве аргументов базовый URL для API и объект c дополнительными опциями для запросов.

**Методы**
- `handleResponse(response: Response): Promise<object> `- метод, который принимает и обрабатывает ответ сервера.
- `get(uri: string)` - метод, который отправляет GET запрос к определенному URI, далее результат от сервера обрабатывается при помощи метода handleResponse и возвращается результат типа Promise.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - метод, принимает URI и данные, которые необходимо отдать на сервер; ответ запроса обрабатывается при помощи метода handleResponse и возвращается результат типа Promise

**Типы и интерфейсы**
- `type ApiListResponse<Type>` - типизация ответа от сервера. Содержит общее число элементов, полученных с сервера, а также массив данных элементов заданного типа.
- `type ApiPostMethods` - типизация различных методов POST запросов.



### Класс WebLarekAPI
Класс `WebLarekAPI` предоставляет методы для взаимодействия с серверным API интернет-магазина и загрузки данных о товарах и заказах. Наследуется от базового класса Api.

**Конструктор**
```new WebLarekAPI(cdn: string, baseUrl: string)```
- `cdn: string` - URL до CDN, который используется для загрузки изображений товаров
- `baseUrl: string` - базовый URL для запросов к серверу

**Методы**
- `getProductList(): Promise<IProduct[]>` - получает список всех товаров. Добавляет к каждому товару корректную ссылку на изображение через CDN.
- `getProductById(id: string): Promise<IProduct>` - получает данные одного товара по его id. Также обогащает объект товара ссылкой на изображение.
- `postOrder(order: IOrder): Promise<IOrderResult>` - отправляет заказ на сервер. Возвращает объект с результатами оформления заказа типа Promise




### Класс Component
Класс `Component` - базовый абстрактный класс, от которого наследуются все визуальные компоненты. Содержит утилитарные методы для работы с DOM.

**Конструктор**
Конструктор класса принимает в качестве аргументов HTML элемент родительского элемента.
```ts
constructor(protected readonly container: HTMLElement)
```

**Методы**
- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` - добавляет или удаляет CSS-класс у элемента.
- `setText(element: HTMLElement, value: unknown): void` - устанавливает текстовое содержимое element.
- `setDisabled(element: HTMLElement, state: boolean): void` - устанавливает или снимает атрибут disabled у элемента формы.
- `setHidden(element: HTMLElement): void` - cкрывает элемент (через display: none).
- `setVisible(element: HTMLElement): void` - Показывает элемент (удаляет display: none).
- `setImage(element: HTMLImageElement, src: string, alt?: string): void` - Устанавливает src и (опционально) alt для изображения.
- `render(data?: Partial<T>): HTMLElement` - Основной метод отрисовки. Обновляет данные компонента и возвращает DOM-элемент container.


### Класс EventEmitter
Класс EventEmitter - классическая реализация событийного брокера на TypeScript. Поддерживает шаблоны событий через регулярные выражения, глобальную подписку на все события и генерацию событий через trigger.

- `on<T>(event: string | RegExp, callback: (data: T) => void): void` - Подписывает функцию-обработчик на событие. Можно использовать строку или регулярное выражение.
- `emit<T>(event: string, data?: T): void` - Вызывает все подписанные обработчики для указанного события. Также вызывает глобальные ('*') и шаблонные (RegExp) слушатели.
- `off(event: string | RegExp, callback: Function): void` - Удаляет конкретный обработчик с события.
- `onAll(callback: (event: { eventName: string, data: unknown }) => void): void` - Подписывает обработчик на все события. Callback получает имя события и данные.
- `offAll(): void` - Сбрасывает все подписчики на все события.
- `trigger<T>(event: string, context?: Partial<T>): (data: T) => void` - Возвращает функцию, при вызове которой будет сгенерировано событие с объединённым контекстом.

**Типы и интерфейсы**
- `type EventName = string | RegExp` — тип события: может быть как строкой, так и регулярным выражением.
- `type Subscriber = Function` — тип обработчика события.
- `type EmitterEvent = { eventName: string, data: unknown }` — объект, передаваемый глобальным обработчикам (onAll).
- `interface IEvents` — интерфейс для классов, реализующих событийную систему. Содержит сигнатуры методов on, emit и trigger.



### Класс Form
Класс Form<T> — универсальный класс для работы с HTML-формами. Реализовывает шаблонную форму с управлением состоянием, валидацией и генерацией событий на изменение и отправку.

**Поля**
- `container: HTMLFormElement` — DOM-элемент формы, к которому привязан компонент.
- `events: IEvents` — объект событийного брокера для генерации событий.
- `_submit: HTMLButtonElement` — кнопка отправки формы.
- `_errors: HTMLElement` — элемент для отображения ошибок.

**Конструктор**
Принимает контейнер формы (`container`) и объект событий (`events`). Настраивает обработчики событий input и submit.

**Методы**
- `protected onInputChange(field: keyof T, value: string): void` - Генерирует событие изменения поля формы. Событие имеет имя ${field}:change и передаёт поле и значение.
- `set valid(value: boolean): void` - Устанавливает состояние валидности формы. Если false, кнопка отправки блокируется.
- `set errors(value: string): void` - Отображает строку с ошибками в специальном элементе формы.
- `render(state: Partial<T> & IFormState): HTMLElement` - Обновляет состояние формы: валидность, ошибки и значения полей. Возвращает контейнер формы.

Типы и интерфейсы
- `interface IFormState` — состояние формы. Содержит:
- `valid: boolean` — признак валидности формы;
- `errors: string[]` — массив ошибок (внутри render можно выводить их строкой).

**Особенности**
- Форма реагирует на изменения полей и эмитит события вида `имяПоля:change`.
- При отправке формы реагирует событие вида `имяФормы:submit`, без отправки на сервер.
- Используется утилита `ensureElement`, которая гарантирует наличие нужного элемента в DOM.



## Модели данных

### Класс BasketModel 
Класс `BasketModel` представляет модель корзины покупок. Он позволяет управлять товарами в корзине, рассчитывать их стоимость и количество, а также генерировать события при изменении состояния корзины.

**Поля**
- `_items: IProduct[]` — массив товаров в корзине.
- `_events: IEvents` — объект событийного брокера для генерации событий при изменении корзины.

**Конструктор**
Принимает объект событийного брокера для генерации событий, таких как изменения в корзине.

**Методы**
`get items(): IProduct[]` - Возвращает массив всех товаров в корзине.
`checkItemInBasket(item: IProduct): boolean` - Проверяет, есть ли товар в корзине, сравнив его id.
`addItem(item: IProduct): void` - Добавляет товар в корзину, если его нет. После добавления генерирует событие `basket:changed.
`removeItem(id: string): void` - Удаляет товар из корзины по его id. После удаления генерирует событие `basket:changed.
`getSumAllItems(): number` - Рассчитывает общую стоимость всех товаров в корзине.
`emptyBasket(): void` - Очищает корзину. Генерирует событие basket:changed после очистки.
`getCounter(): number` - Возвращает количество товаров в корзине.

**Типы и интерфейсы**
`interface IBasketModel` - интерфейс для модели корзины. Содержит методы для добавления и удаления товаров, получения общей стоимости и количества товаров, а также очищения корзины.


### Класс OrderModel 
Класс `OrderModel` представляет модель заказа. Он позволяет управлять данными заказа, проверять их на валидность и генерировать события при изменении состояния.

**Поля**
- `address: string` — адрес доставки.
- `payment: string` — способ оплаты (например, наличными или картой).
- `email: string` — почтовый адрес клиента.
- `phone: string` — номер телефона клиента.
- `total: number` — общая стоимость заказа.
- `items: string[]` — массив идентификаторов товаров в заказе.
- `error: Partial<Record<keyof IOrderData, string>>` — объект для хранения ошибок валидации данных заказа.

**Конструктор**
Принимает объект событийного брокера для генерации событий при проверке данных.

**Методы**
- `setOrderData(field: keyof IOrderData, value: string): void` - Устанавливает значение для указанного поля заказа (например, адрес, платежный способ).
- `setTotalSum(value: number): void` - Устанавливает общую сумму заказа.
- `setItems(items: string[]): void` - Устанавливает список товаров в заказе.
- `checkOrderValidation(): boolean` - Проверяет валидность данных заказа (адрес и способ оплаты). Генерирует событие order:validation с ошибками, если таковые имеются. Возвращает true, если все данные валидны, и false в противном случае.
- `checkContactsValidation(): boolean` - Проверяет валидность контактных данных (номер телефона и почта). Генерирует событие contacts:validation с ошибками, если таковые имеются. Возвращает true, если все данные валидны, и false в противном случае.
- `getOrderData(): IOrderData` - Возвращает объект с данными заказа, готовыми для отправки (с учетом преобразования способа оплаты).
- `clearOrderData(): void` - Очищает все данные заказа (адрес, почта, телефон, товары и т. д.).

**Типы и интерфейсы**
- `interface IOrderModel` - Интерфейс для модели заказа. Содержит методы для установки данных заказа, проверки валидности и получения данных для отправки.


### Класс ProductCatalogModel 
Класс `ProductCatalogModel` представляет модель каталога товаров. Он позволяет управлять списком каталога товаров на главной странице и генерировать события при изменении данных каталога.

**Поля**
- `_products: IProduct[]` — массив товаров в каталоге.
- `_events: IEvents` — объект событийного брокера для генерации событий при изменении списка товаров.

**Конструктор**
Принимает объект событийного брокера для генерации событий, таких как изменения в списке товаров.

**Методы**
- `get products(): IProduct[]` - Возвращает массив всех товаров в каталоге.
- `set products(data: IProduct[]): void` - Устанавливает новый список товаров в каталог. После установки генерирует событие `products:changed`, чтобы другие компоненты могли реагировать на изменения.

**Типы и интерфейсы**
- `interface IProductCatalogModel` - Интерфейс для модели каталога товаров. Содержит методы для получения и установки списка товаров.


## Классы отображений

### Класс Product
Класс `Product` представляет товар на карточке в каталоге. Он управляет отображением свойств товара (таких как название, категория, цена, описание) и предоставляет возможность взаимодействовать с товаром через кнопки.

**Поля**
- `_id: string` — уникальный идентификатор товара.
- `_productButton: HTMLButtonElement` — кнопка для взаимодействия с товаром (например, добавление в корзину).
- `_title: HTMLElement` — элемент, отображающий название товара.
- `_category: HTMLElement` — элемент, отображающий категорию товара.
- `_price: HTMLElement` — элемент, отображающий цену товара.
- `_image: HTMLImageElement` — элемент, отображающий изображение товара.
- `_cardButton?: HTMLButtonElement` — дополнительная кнопка для действий с товаром (например, для добавления/удаления из корзины).
- `_description?: HTMLElement` — элемент, отображающий описание товара.

**Конструктор**
Принимает контейнер (HTML-элемент) для отображения товара, объект событийного брокера для обработки событий и опциональный объект actions для обработки кликов по кнопкам.

**Методы**
- `set color(value: string | null): void` — устанавливает цвет категории товара, добавляя соответствующий класс.
- `set title(value: string): void` — устанавливает название товара.
- `get title(): string` — возвращает название товара.
- `set id(value: string): void` — устанавливает идентификатор товара.
- `get id(): string` — возвращает идентификатор товара.
- `set image(value: string): void` — устанавливает изображение товара.
- `get image(): string` — возвращает URL изображения товара.
- `set category(value: string): void` — устанавливает категорию товара.
- `get category(): string` — возвращает категорию товара.
- `set price(value: number | null): void` — устанавливает цену товара, если не задано, отображается "Бесценно".
- `get price(): number | null` — возвращает цену товара.
- `set description(value: string): void` — устанавливает описание товара.
- `get description(): string` — возвращает описание товара.
- `set inBasket(value: boolean): void` — изменяет текст на кнопке товара в зависимости от того, добавлен ли товар в корзину.


### Класс Basket
Класс `Basket` представляет корзину покупок. Он управляет отображением списка товаров в корзине, общей ценой и состоянием кнопки.

**Поля**
- `_list: HTMLUListElement` — элемент списка товаров в корзине.
- `_button: HTMLButtonElement` — кнопка для взаимодействия с корзиной.
- `_total: HTMLSpanElement` — элемент, отображающий общую цену корзины.

**Конструктор**
Принимает контейнер (HTML-элемент) для отображения корзины, объект событийного брокера для обработки событий и опциональный объект actions для обработки кликов по кнопке.

**Методы**
- `set items(items: HTMLElement[]): void` — устанавливает список товаров в корзине, заменяя старые элементы новыми.
- `set price(value: number): void` — устанавливает общую цену корзины, отображая её в формате "X синапсов".
- `set isDisabled(value: boolean): void` — устанавливает состояние кнопки (активна/неактивна), вызывая метод setDisabled из родительского класса.


### Класс BasketItem
Класс `BasketItem` представляет отдельный товар в корзине. Он управляет отображением свойств товара (индекс, название, цена) и обработкой действия удаления товара.

**Поля**
- `_index: HTMLSpanElement` — элемент, отображающий индекс товара в корзине.
- `_title: HTMLSpanElement` — элемент, отображающий название товара.
- `_price: HTMLSpanElement` — элемент, отображающий цену товара.
- `_removeButton: HTMLButtonElement` — кнопка для удаления товара из корзины.
- `_id?: string | null` — уникальный идентификатор товара в корзине.

**Конструктор**
Принимает контейнер (HTML-элемент) для отображения товара, объект событийного брокера для обработки событий и опциональный объект actions для обработки кликов по кнопке удаления.

**Методы**
- `set id(value: string): void` — устанавливает уникальный идентификатор товара.
- `set indexInBasket(value: number): void` — устанавливает индекс товара в корзине.
- `set title(value: string): void` — устанавливает название товара.
- `set price(value: string): void` — устанавливает цену товара, отображая её в соответствующем элементе.



### Класс ContactsForm
Класс `ContactsForm` управляет формой для ввода контактной информации (email и телефон). Он расширяет базовый класс Form, предоставляя логику для работы с контактами.

**Поля**
- `_emailInput: HTMLInputElement` — элемент для ввода email.
- `_phoneInput: HTMLInputElement` — элемент для ввода телефона.

**Конструктор**
Принимает контейнер формы (HTML-элемент) и объект событийного брокера для обработки событий, инициализирует поля формы для ввода данных.

**Методы**
- `set email(value: string): void` — устанавливает значение в поле ввода email.
- `set phone(value: string): void` — устанавливает значение в поле ввода телефона.



### Класс Modal
Класс `Modal` управляет модальным окном, включая отображение, скрытие и взаимодействие с пользователем через кнопки и события.

**Поля**
- `_closeButton: HTMLButtonElement` — кнопка для закрытия модального окна.
- `_content: HTMLElement` — элемент, который включает в себя контент модального окна.

**Конструктор**
Принимает контейнер для модального окна (HTML-элемент) и объект событийного брокера для обработки событий. Инициализирует кнопку закрытия и содержимое модального окна, а также добавляет обработчики событий.

**Методы**
- `set content(value: HTMLElement): void` — устанавливает содержимое модального окна, заменяя старое.
- `open(): void` — открывает модальное окно, добавляя активный класс и эмитируя событие открытия.
- `close(): void` — закрывает модальное окно, удаляя активный класс и эмитируя событие закрытия.
- `render(data: IModalData): HTMLElement` — рендерит модальное окно с новым контентом и открывает его.



### Класс OrderForm
Класс `OrderForm` управляет формой оформления заказа, включая выбор способа оплаты и валидацию ввода данных.

**Поля**
- `_addressInput: HTMLInputElement` — поле для ввода адреса.
- `_cardPaymentButton: HTMLButtonElement` — кнопка выбора оплаты картой.
- `_cashPaymentButton: HTMLButtonElement` — кнопка выбора оплаты наличными.
- `_buttons: HTMLElement[]` — список кнопок выбора метода оплаты.

**Конструктор**
Принимает контейнер формы (HTML-элемент), объект событийного брокера и необязательные действия для кнопок. Инициализирует поля ввода и кнопки, а также добавляет обработчики событий.

**Методы**
- `set addressInput(value: string): void` — устанавливает значение для поля ввода адреса.
- `setPaymentType(value: string): void` — устанавливает выбранный метод оплаты, активируя соответствующую кнопку и деактивируя остальные.


### Класс Page
Класс `Page` управляет отображением страницы с каталогом товаров, корзиной и модальными окнами.

**Поля**
- `_catalogContainer: HTMLElement` — контейнер для списка товаров.
- `_modalContainer: HTMLElement` — контейнер для модальных окон.
- `_basketCounter: HTMLSpanElement` — элемент для отображения количества товаров в корзине.
- `_basket: HTMLButtonElement` — кнопка для открытия корзины.
- `_pageWrapper: HTMLElement` — обертка страницы для управления блокировкой.

**Конструктор**
Инициализирует все элементы и добавляет обработчик для открытия корзины по клику.

**Методы**
- `set productsList(products: HTMLElement[]): void` — заменяет текущий список товаров на новый.
- `set productPreview(product: HTMLElement): void` — заменяет содержимое модального окна на представление товара.
- `set basketCounter(value: number): void` — устанавливает количество товаров в корзине.
- `set lockWrapper(enable: boolean): void` — блокирует или разблокирует обертку страницы, добавляя или убирая класс блокировки.



###  Класс Success
Класс `Success` управляет отображением View успешного оформления заказа.

**Поля**
- `_priceElement: HTMLParagraphElement` — элемент, отображающий стоимость заказа.
- `_button: HTMLButtonElement` — кнопка для закрытия страницы успешного заказа.

**Конструктор**
Инициализирует элементы и добавляет обработчик для кнопки закрытия.

**Методы**
- `set total(value: number): void` — устанавливает текст на элементе _priceElement, показывая списанную сумму синапсов.






## Типы и интерфейсы
**Ответ от API со списком элементов**
```ts
type ApiListResponse<Type> = {
  total: number;
  items: Type[];
}
```

**Допустимые HTTP-методы для изменения данных**
```ts 
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'
```

**Продукт**
```ts 
interface IProduct {
  id: string;
  category: string;
  title: string;
  image: string;
  price: number | null;
  description: string;
  color: string | null;
  inBasket: boolean;
  indexInBasket: number;
}
```

**Каталог продуктов**
```ts 
interface IProductCatalogModel {
  products: IProduct[];
}
```

**Цвета категорий**
```ts 
enum CategoryColors {
  'другое' = 'other',
  'софт-скил' = 'soft',
  'дополнительное' = 'additional',
  'кнопка' = 'button',
  'хард-скил' = 'hard',
}
```

**Форма заказа (адрес и оплата)**
```ts 
interface IOrderForm {
  address: string;
  payment: string;
}
```

**Контактная форма (почта и телефон)**
```ts 
interface IContactsForm {
  email: string;
  phone: string;
}
```

**Общие данные заказа**
```ts 
type IOrderData = IOrderForm & IContactsForm;
```

**Заказ для отправки**
```ts 
type IOrder = IOrderData & {
  total: number;
  items: string[];
};
```

**Ответ после оформления заказа**
```ts 
interface IOrderResult {
  id: string;
  total: number;
}
```